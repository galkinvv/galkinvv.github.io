::This script creates an delete folders with special names to force rebuilding of internal NTFS root dir structure
::Place it in the EFI folder on NTFS partition and run exactly once
::Discussion at https://winraid.level1techs.com/t/solution-workaround-for-uefi-ntfs-driver-problems-with-accessing-efi-folder/91337

@echo Fix NTFS root for buggy UEFI v1.0
@if NOT "%~p0"=="\EFI\" echo Move this script to EFI folder of problematic NTFS partition and run from there && pause && exit 1
@set DRIVE=%~d0
@cd /d %DRIVE%\
@echo Temporarily creating folders in %DRIVE%\
@mkdir "\$EFI_NTFS_DRIVER_FIX_FOLDER_WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@mkdir "\$EFI_NTFS_DRIVER_FIX_FOLDER2WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@mkdir "\$EFI_NTFS_DRIVER_FIX_FOLDER3WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@mkdir "\$EFI_NTFS_DRIVER_FIX_FOLDER4WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@mkdir "\$EFI_NTFS_DRIVER_FIX_FOLDER5WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"

@echo - Removing just created folders in %DRIVE%\
@rmdir "\$EFI_NTFS_DRIVER_FIX_FOLDER_WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@rmdir "\$EFI_NTFS_DRIVER_FIX_FOLDER2WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@rmdir "\$EFI_NTFS_DRIVER_FIX_FOLDER3WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@rmdir "\$EFI_NTFS_DRIVER_FIX_FOLDER4WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
@rmdir "\$EFI_NTFS_DRIVER_FIX_FOLDER5WITH_LONGEST_POSSIBLE_NAME1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"

@echo All done, now UEFI NTFS driver should be able to access drive %DRIVE%
@echo.
@echo Note that some BIOSes may have another bugs regarding boot menu,
@echo so for maximal chance to see NTFS-based EFI folder in boot menu you should
@echo - power off
@echo - disconnect the drive
@echo - power on, see boot menu without drive
@echo - power off again
@echo - reconnect the drive
@echo - power on again and hope that NYFS-based boot menu entry is here!
@echo.
@echo - Do NOT run this tool second time - sometimes it can lead to the opposite effect.
@echo.
@pause